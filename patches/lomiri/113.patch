From eb1714b6f753d369df55af44d3c191ffd67ab491 Mon Sep 17 00:00:00 2001
From: d2weber <5274036-d2weber@users.noreply.gitlab.com>
Date: Mon, 8 Dec 2025 16:04:29 +0100
Subject: [PATCH 1/3] Fix scaling for animated images

The scaling image provider does not work for animated images. This
prohibits the use of the AnimatedImage QML element with lomiri. So we
exempt file formats that are common for animated images (gif, webp) from
using it.
---
 src/LomiriToolkit/ucqquickimageextension.cpp | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/LomiriToolkit/ucqquickimageextension.cpp b/src/LomiriToolkit/ucqquickimageextension.cpp
index 5f4df7680..070685c2c 100644
--- a/src/LomiriToolkit/ucqquickimageextension.cpp
+++ b/src/LomiriToolkit/ucqquickimageextension.cpp
@@ -160,7 +160,9 @@ void UCQQuickImageExtension::reloadSource()
     if (scaleFactor == QStringLiteral("1")) {
         if (qFuzzyCompare(qGuiApp->devicePixelRatio(), (qreal)1.0)
             || selectedFilePath.endsWith(QStringLiteral(".svg"))
-            || selectedFilePath.endsWith(QStringLiteral(".svgz"))) {
+            || selectedFilePath.endsWith(QStringLiteral(".svgz"))
+            || selectedFilePath.endsWith(QStringLiteral(".gif"))
+            || selectedFilePath.endsWith(QStringLiteral(".webp"))) {
             // Take care to pass the original fragment
             QUrl selectedFileUrl(QUrl::fromLocalFile(selectedFilePath));
             if (m_source.hasFragment()) {
-- 
GitLab


From 160ec490a04968932aa43411dab9869c7308bb86 Mon Sep 17 00:00:00 2001
From: d2weber <5274036-d2weber@users.noreply.gitlab.com>
Date: Sun, 14 Dec 2025 10:21:02 +0000
Subject: [PATCH 2/3] Apply 1 suggestion(s) to 1 file(s)

Co-authored-by: Henrik Schnor <hschnor@mailbox.org>
---
 src/LomiriToolkit/ucqquickimageextension.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/LomiriToolkit/ucqquickimageextension.cpp b/src/LomiriToolkit/ucqquickimageextension.cpp
index 070685c2c..a3bdc48f8 100644
--- a/src/LomiriToolkit/ucqquickimageextension.cpp
+++ b/src/LomiriToolkit/ucqquickimageextension.cpp
@@ -114,7 +114,8 @@ void UCQQuickImageExtension::reloadSource()
     if (!qmlEngine(m_image)) {
         return;
     }
-    if (m_source.isEmpty()) {
+    // QQuickAnimatedImage doesn't support image providers
+    if (m_source.isEmpty() || m_image->inherits("QQuickAnimatedImage")) {
         m_image->setSource(m_source);
         return;
     }
-- 
GitLab


From 3af16d67dbe7116d37a31f7340ad0b68f4c005c0 Mon Sep 17 00:00:00 2001
From: d2weber <5274036-d2weber@users.noreply.gitlab.com>
Date: Sun, 14 Dec 2025 11:14:42 +0100
Subject: [PATCH 3/3] Revert "Fix scaling for animated images"

This reverts commit 79c46f0aa2ea5f68d442a4839de88a294dcfdc11.
---
 src/LomiriToolkit/ucqquickimageextension.cpp | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/src/LomiriToolkit/ucqquickimageextension.cpp b/src/LomiriToolkit/ucqquickimageextension.cpp
index a3bdc48f8..a923d9fa1 100644
--- a/src/LomiriToolkit/ucqquickimageextension.cpp
+++ b/src/LomiriToolkit/ucqquickimageextension.cpp
@@ -161,9 +161,7 @@ void UCQQuickImageExtension::reloadSource()
     if (scaleFactor == QStringLiteral("1")) {
         if (qFuzzyCompare(qGuiApp->devicePixelRatio(), (qreal)1.0)
             || selectedFilePath.endsWith(QStringLiteral(".svg"))
-            || selectedFilePath.endsWith(QStringLiteral(".svgz"))
-            || selectedFilePath.endsWith(QStringLiteral(".gif"))
-            || selectedFilePath.endsWith(QStringLiteral(".webp"))) {
+            || selectedFilePath.endsWith(QStringLiteral(".svgz"))) {
             // Take care to pass the original fragment
             QUrl selectedFileUrl(QUrl::fromLocalFile(selectedFilePath));
             if (m_source.hasFragment()) {
-- 
GitLab

